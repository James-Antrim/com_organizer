jQuery(document).ready(function(){window.scheduleApp=new ScheduleApp(Joomla.getOptions("variables",{}))});const ScheduleApp=function(u){const d=this,v=new XMLHttpRequest(),t=document.getElementById("future-date"),Q=document.getElementById("next-date-selection"),L=document.getElementById("no-events"),O=document.getElementById("past-date"),w=document.getElementById("reg-fifo"),H=document.getElementById("reg-manual"),f=document.getElementById("scheduleWrapper"),C=[Joomla.JText._("MON"),Joomla.JText._("TUE"),Joomla.JText._("WED"),Joomla.JText._("THU"),Joomla.JText._("FRI"),Joomla.JText._("SAT"),Joomla.JText._("SUN")],k=(function(){let pattern=u.dateFormat;pattern=pattern.replace(/d/,"([0-9]{2})");pattern=pattern.replace(/j/,"([0-9]{1,2})");pattern=pattern.replace(/m/,"([0-9]{2})");pattern=pattern.replace(/n/,"([0-9]{1,2})");pattern=pattern.replace(/y/,"([0-9]{2})");pattern=pattern.replace(/Y/,"([0-9]{4})");pattern=pattern.replace(/[/]/g,"\\/");pattern=pattern.replace(/[.]/g,"\\.");return new RegExp(pattern)})();let calendar,form,instanceMenu,scheduleObjects;function p(){const aa=document.getElementById("calendar"),Y=document.getElementById("display-month"),S=[Joomla.JText._("JANUARY"),Joomla.JText._("FEBRUARY"),Joomla.JText._("MARCH"),Joomla.JText._("APRIL"),Joomla.JText._("MAY"),Joomla.JText._("JUNE"),Joomla.JText._("JULY"),Joomla.JText._("AUGUST"),Joomla.JText._("SEPTEMBER"),Joomla.JText._("OCTOBER"),Joomla.JText._("NOVEMBER"),Joomla.JText._("DECEMBER")],ab=document.getElementById("calendar-table"),X=this,Z=document.getElementById("display-year");let activeDate=new Date(),calendarIsVisible=false;function U(){const ac=document.getElementsByClassName("date-input")[0].getElementsByClassName("controls");let controlIndex;for(controlIndex=0;controlIndex<ac.length;++controlIndex){ac[controlIndex].style.display="inline"}}function W(){Y.innerHTML=S[activeDate.getMonth()];Z.innerHTML=activeDate.getFullYear().toString()}function R(){const ad=ab.getElementsByTagName("tbody")[0],ac=ab.getElementsByTagName("tr").length;let rowIndex;for(rowIndex=0;rowIndex<ac;++rowIndex){ad.deleteRow(-1)}}function T(){const af=new Date(activeDate.getFullYear(),activeDate.getMonth(),1),ag=activeDate.getMonth()+1,ai=[4,6,9,11],aj=ab.getElementsByTagName("tbody")[0],ad=af.getDay()||7,ae=activeDate.getFullYear();let cellIndex,days=31,day=1,rowCount,rowIndex;if(ai.indexOf(ag)!==-1){days=30}if(ag===2){days=(ae%4===0)?29:28}rowCount=Math.min(Math.ceil((days+af.getDay()-1)/7),6);for(rowIndex=0;rowIndex<=rowCount;++rowIndex){const ah=aj.insertRow(rowIndex);for(cellIndex=0;cellIndex<=6;++cellIndex){const ac=ah.insertCell(cellIndex);if((rowIndex===0&&cellIndex<ad-1)||day>days){ac.innerHTML=" "}else{V(new Date(ae,ag-1,day),ac);++day}}}}function V(ad,ac){const ae=document.createElement("button");ae.type="button";ae.className="day";ae.innerHTML=ad.getDate().toString();ae.addEventListener("click",function(){X.insertDate(ad)},false);ac.appendChild(ae)}this.changeCalendarMonth=function(ac){if(ac){activeDate.setMonth(activeDate.getMonth()+1,1)}else{activeDate.setMonth(activeDate.getMonth()-1,1)}this.setUpCalendar()};this.changeSelectedDate=function(ad,ac){b(ad,ac);d.updateSchedule();if(calendarIsVisible){this.setUpCalendar()}};this.showCalendar=function(){aa.style.visibility=(calendarIsVisible)?"hidden":"visible";calendarIsVisible=!calendarIsVisible;if(calendarIsVisible){this.setUpCalendar()}};this.hideCalendar=function(){aa.style.visibility="hidden";calendarIsVisible=false};this.insertDate=function(ac){activeDate=(typeof ac==="undefined")?new Date():ac;d.dateField.value=activeDate.getPresentationFormat();window.sessionStorage.setItem("scheduleDate",activeDate.toJSON());this.hideCalendar();d.updateSchedule()};this.setUpCalendar=function(){R();W();T()};this.isVisible=function(){return calendarIsVisible};(function(){X.activeDate=a();U();d.dateField.addEventListener("change",X.setUpCalendar);document.getElementById("today").addEventListener("click",function(){X.insertDate();X.setUpCalendar()})})()}function P(W,R,X){const S=new XMLHttpRequest(),Y=(W==="user"?W:R?W+R:W+y(W,"-")),V=W,U=R?R:W==="user"?null:y(W,"-"),T=this;let events=[],table,ajaxUrl=(function(){let url=N();url+="&view=instances";url+="&date="+h()+(u.isMobile?"&interval=day":"");url+="&delta="+u.delta;if(V==="user"){url+="&mySchedule="+(V==="user"?"1":"0")}else{url+="&"+V+"IDs="+U}return url})(),title=(function(){const aa=document.getElementById(V),Z=document.getElementById("category"),ab=[];if(X){return X}if(V==="user"){return Joomla.JText._("ORGANIZER_MY_SCHEDULE")}if(V==="group"&&Z.selectedIndex!==-1){(function(){const ac=Z.options;let index;for(index=0;index<ac.length;++index){if(ac[index].selected){ab.push(ac[index].text);return}}})()}if(aa&&aa.selectedIndex!==-1){(function(){const ac=aa.options;let index;for(index=0;index<ac.length;++index){if(ac[index].selected){ab.push(ac[index].text);return}}})()}if(ab.length>0){return ab.join(" - ")}return u.displayName||""}());this.requestUpdate=function(Z){ajaxUrl=ajaxUrl.replace(/(date=)\d{4}-\d{2}-\d{2}/,"$1"+h());S.open("GET",ajaxUrl,true);S.onreadystatechange=function(){if(S.readyState===4&&S.status===200){const aa=JSON.parse(S.responseText);events=aa;table.update(aa);T.popUp();if(Y===c()){if(aa.pastDate||aa.futureDate){o(aa)}else{if(aa.pastDate===null&&aa.futureDate===null){L.style.display="block"}}}if(Z){scheduleObjects.schedules.forEach(function(ab){if(ab.getId()!==Y){ab.updateTable()}})}}};S.send()};this.updateTable=function(){table.update();T.popUp()};this.popUp=function(Z){let cancelBtn,floatDiv=document.getElementById(Y+"-pop-up"),titleElement;if(floatDiv){floatDiv.removeChild(floatDiv.lastChild);jQuery(table.getTableElement()).clone(true).appendTo(jQuery(floatDiv))}else{if(Z){floatDiv=document.createElement("div");floatDiv.id=Y+"-pop-up";floatDiv.className="pop-up schedule-table";floatDiv.style.zIndex=E(".pop-up.schedule-table");floatDiv.draggable=true;floatDiv.addEventListener("dragstart",function(aa){const ab={id:aa.target.id,x:aa.pageX,y:aa.pageY};aa.dataTransfer.setData("text",JSON.stringify(ab));aa.dropEffect="move"});floatDiv.addEventListener("click",function(){this.style.zIndex=E(".pop-up.schedule-table")});cancelBtn=document.createElement("button");cancelBtn.className="icon-cancel";cancelBtn.addEventListener("click",function(){this.parentElement.style.display="none"});floatDiv.appendChild(cancelBtn);titleElement=document.createElement("h3");titleElement.innerHTML=title;floatDiv.appendChild(titleElement);document.getElementsByClassName("organizer")[0].appendChild(floatDiv);jQuery(table.getTableElement()).clone(true).appendTo(jQuery(floatDiv))}}if(Z){floatDiv.style.display="block"}};this.getId=function(){return Y};this.getResource=function(){return V};this.getResourceIDs=function(){return U};this.getTitle=function(){return title};this.getTable=function(){return table};(function(){table=new m(T);T.requestUpdate();scheduleObjects.addSchedule(T);B(T)})()}function m(ap){const aq=document.createElement("table"),am=4,al=3,ad=1,R=2,Z=ap.getId()==="user",af=7;let defaultGrid=null,instanceElements=[],instances={},timeGrid=M(),timeGridID=y("grid"),useDefaultGrid=true,visibleDay=a().getDay();function ag(aA,ax,aB){const ay=document.createElement("div"),az=document.createElement("button"),aw=document.createElement("button");az.className=aB=="save"?"icon-plus":"icon-delete";az.addEventListener("click",function(){x(aA.dataset.instanceID,u.BLOCK_MODE,true)});aw.className="icon-question";aw.addEventListener("click",function(){instanceMenu.getMenu(aA,ax,aB)});ay.className=aB=="save"?"add-instance":"delete-instance";ay.appendChild(az);ay.appendChild(aw);aA.appendChild(ay)}function aa(ax,aw){if(aw.comment){const ay=document.createElement("div");ay.innerHTML=aw.comment;ay.className="comment-container";ax.appendChild(ay)}}function ai(aw,ax,az,ay){aw.addEventListener("click",function(){l(ax,az,ay)})}function ae(ay,aw){const ax=document.createElement("div"),az=function(){window.open(u.subjectItemBase.replace(/&id=\d+/,"&id="+aw.subjectID),"_blank")};let nameElement,numberElement;if(aw.subjectID){nameElement=document.createElement("a");nameElement.addEventListener("click",az)}else{nameElement=document.createElement("span")}nameElement.className="name";nameElement.innerHTML=aw.name;nameElement.innerHTML+=aw.methodCode?" - "+aw.methodCode:"";nameElement.innerHTML=nameElement.innerHTML.replace(/(\S)\/(\S)/g,"$1 / $2");ax.appendChild(nameElement);if(aw.subjectNo){if(aw.subjectID){numberElement=document.createElement("a");numberElement.addEventListener("click",az)}else{numberElement=document.createElement("span")}numberElement.className="module";numberElement.innerHTML=aw.subjectNo;ax.appendChild(numberElement)}ay.appendChild(ax)}function av(ax,aw){if(u.userID){ax.addEventListener("contextmenu",function(ay){if(!ay.classList.contains("instance-removed")){ay.preventDefault();instanceMenu.getMenu(ay,aw,"save")}if(ay.classList.contains("added")){ay.preventDefault();instanceMenu.getMenu(ay,aw,"delete")}})}}function ah(aw,ay){if(Object.keys(ay).length){const ax=Object.keys(ay).sort();let key;for(key in ax){aw.appendChild(ay[ax[key]])}}}function an(ay,aw){const az=ap.getResource(),ax=!(ay.classList.contains("instance-new")||ay.classList.contains("instance-removed"));let addGroups=false,aggregateGroups=true,aggregateRooms=true,initial=true,group,groupsDiv,groupID,groupIDs,groupKey,groupName,groups={},groupStatus,person,personDiv,personID,personIDs,personKey,personName,personSpan,personStatus,addRooms=false,room,roomsDiv,roomID,roomIDs,roomKey,roomName,rooms={},roomStatus,speakers=[],supervisors=[],teachers=[],tutors=[];if(az==="group"){T(ay,aw)}}function T(az,aw){const ay=Object.keys(aw.resources),aA=ap.getResourceIDs(),ax=!(az.classList.contains("instance-new")||az.classList.contains("instance-removed"));let aggregateRooms=true,count,groupIDs,groupKey,groupID,groupStatus,initial=true,initialRooms=true,instanceGroupStatus,instanceRooms={},person,personDiv,personDivs,personKey,personID,personName,persons=[],personSpan,personRelevant,personStatus,roleDiv,roleID,roleIDs,roleKey,roleName,rolePersons=[],roomID,roomIDs,roomKey,roomName,roomNames,rooms,roomsDiv,roomStatus;for(personKey in ay){personID=ay[personKey];person=aw.resources[personID];if(!person.groups){continue}personRelevant=false;groupIDs=Object.keys(person.groups);for(groupKey in groupIDs){groupID=groupIDs[groupKey];if(!aA.includes(groupID)){continue}personRelevant=true;groupStatus=person.groups[groupID].status;if(initial){instanceGroupStatus=groupStatus;initial=false}else{if(instanceGroupStatus!==false&&instanceGroupStatus!==groupStatus){instanceGroupStatus=false}}}if(!personRelevant){continue}personDiv=document.createElement("div");personDiv.className="persons";personName=person.person;roleID=person.roleID;personSpan=document.createElement("span");personSpan.classList.add("person");personStatus=groupStatus==="removed"||person.status==="removed"?"removed":person.status||"";personSpan.innerHTML=personName;if(personStatus){personSpan.classList.add(personStatus)}if(!rolePersons[roleID]){rolePersons[roleID]={}}rolePersons[roleID][personName]=personSpan;personDiv.appendChild(personSpan);if(personStatus!=="removed"&&person.rooms){rooms={};roomIDs=Object.keys(person.rooms);for(roomKey in roomIDs){roomID=roomIDs[roomKey];roomName=person.rooms[roomID].room;roomStatus=person.rooms[roomID].status;ab(rooms,roomID,roomName,roomName,roomStatus,"room")}if(Object.keys(rooms)){roomsDiv=document.createElement("div");ah(roomsDiv,rooms);personDiv.appendChild(roomsDiv)}if(initialRooms){instanceRooms=rooms;initialRooms=false}else{if(instanceRooms!==false&&JSON.stringify(instanceRooms)!==JSON.stringify(rooms)){aggregateRooms=false;instanceRooms=false}}}}if(aggregateRooms){personDiv=document.createElement("div");personDiv.className="persons";roleIDs=Object.keys(rolePersons);for(roleKey in roleIDs){roleID=roleIDs[roleKey];count=Object.keys(rolePersons[roleID]).length;roleDiv=document.createElement("div");if(roleID===am){roleName=count>1?Joomla.JText._("ORGANIZER_SPEAKERS"):Joomla.JText._("ORGANIZER_SPEAKER");roleDiv.classList.add("speakers")}else{if(roleID===R){roleName=count>1?Joomla.JText._("ORGANIZER_TUTORS"):Joomla.JText._("ORGANIZER_TUTOR");roleDiv.classList.add("tutors")}else{if(roleID===al){roleName=count>1?Joomla.JText._("ORGANIZER_SUPERVISORS"):Joomla.JText._("ORGANIZER_SUPERVISOR");roleDiv.classList.add("supervisors")}else{roleName=count>1?Joomla.JText._("ORGANIZER_TEACHERS"):Joomla.JText._("ORGANIZER_TEACHER");roleDiv.classList.add("teachers")}}}roleDiv.innerHTML=roleName+": "+Object.keys(rolePersons[roleID]).sort().join(", ");personDiv.appendChild(roleDiv)}if(Object.keys(instanceRooms).length){roomsDiv=document.createElement("div");roomsDiv.classList.add("rooms");roomNames=Object.keys(instanceRooms).sort();for(roomName in roomNames){roomsDiv.append(instanceRooms[roomNames[roomName]]);roomsDiv.innerHTML+=", "}roomsDiv.innerHTML=roomsDiv.innerHTML.substr(0,roomsDiv.innerHTML.length-2);personDiv.appendChild(roomsDiv)}az.appendChild(personDiv)}}function ab(aC,aD,ax,aB,aw,az){const aA=document.createElement("a"),ay=document.createElement("span");aA.innerHTML=ax;ai(aA,az,aD,aB);ay.classList.add(az);ay.appendChild(aA);if(aw){ay.classList.add(aw)}aC[ax]=ay}function S(aG,aF){const aD=[],aB=[],aH=document.createElement("div"),az=ap.getId(),ay=ap.getResource(),ax=[],aE=[],aA=[],aC=[];let propertyName;aH.classList.add("instance");aH.dataset.instanceID=aG.instanceID;aH.dataset.registrationType=aG.registrationType;if(aG.unitStatus||aG.status){if(aG.unitStatus==="removed"||aG.status==="removed"){aH.classList.add("instance-removed")}else{if(aG.unitStatus==="new"||aG.status==="new"){aH.classList.add("instance-removed")}}}aF=typeof aF==="undefined"?false:aF;if(aF&&aG.startTime&&aG.endTime){const aw=document.createElement("span");aw.className="own-time";aw.innerHTML=aG.startTime+" - "+aG.endTime;aH.appendChild(aw)}ae(aH,aG);aa(aH,aG);an(aH,aG);if(aG.full){aH.classList.add("full")}av(aH,aG);if(u.userID){av(aH,aG);ag(aH,aG,"delete");ag(aH,aG,"save")}else{aH.classList.add("no-saving")}return aH}function ao(){const ay=document.createElement("input"),aB=document.createElement("div"),aw=document.createElement("tbody"),az=timeGrid.hasOwnProperty("periods")?timeGrid:JSON.parse(u.defaultGrid),ax=Object.keys(az.periods).length;let firstDay,rowIndex;ay.className="schedule-input";ay.type="radio";ay.setAttribute("id",ap.getId()+"-input");ay.setAttribute("name","schedules");ay.setAttribute("checked","checked");f.appendChild(ay);aB.setAttribute("id",ap.getId()+"-schedule");aB.setAttribute("class","schedule-table");aB.appendChild(aq);f.appendChild(aB);aq.appendChild(aw);for(rowIndex=0;rowIndex<ax;++rowIndex){const aA=aw.insertRow(-1);for(firstDay=0;firstDay<af;++firstDay){aA.insertCell(-1)}}}function W(){if(!defaultGrid){const aw=(function(){let day,event,time;for(day in instances){if(!instances.hasOwnProperty(day)){continue}for(time in instances[day]){if(!instances[day].hasOwnProperty(time)){continue}for(event in instances[day][time]){if(instances[day][time].hasOwnProperty(event)&&instances[day][time][event].gridID){return instances[day][time][event].gridID}}}}})();if(aw){n(aw);defaultGrid=JSON.parse(u.grids[aw].grid)}}return defaultGrid||timeGrid}function at(ax,aw){const ay=[];let block,blockIndex,contains,ends,equals,overlaps,starts;for(blockIndex in timeGrid.periods){block=timeGrid.periods[blockIndex];if(block.startTime>ax){break}if(block.endTime<aw){continue}contains=block.endTime>=ax&&block.startTime<=aw;ends=block.endTime>ax&&block.startTime<ax;equals=block.endTime===ax&&block.startTime===aw;if(contains||ends||equals){ay.push(blockIndex-1);break}overlaps=block.endTime<ax&&block.startTime>aw;starts=block.endTime>aw&&block.startTime<aw;if(overlaps||starts){ay.push(blockIndex-1);continue}}return ay}function ak(aw){const ay=ap.getResource(),ax=ap.getResourceIDs();let groupID,person,personID,roomID;for(personID in aw.resources){for(groupID in person.groups){if(!person.groups.hasOwnProperty(groupID)){continue}}for(roomID in person.rooms){if(!person.rooms.hasOwnProperty(roomID)){continue}if(ay==="room"&&!ax.includes(roomID)){delete aw.resources.personID.rooms.roomID;continue}}if(ay==="room"&&!Object.keys(aw.resources[personID].rooms).length){delete aw.resources.personID;continue}}}function aj(ax){const ay=Object.keys(ax),aw=aq.getElementsByTagName("tbody")[0].getElementsByTagName("tr");let block,blockIndex,cell,iDoW,iEndTime,index,instance,iStartTime,item,relevantBlocks,showOwnTime;for(index in ay){instance=ax[ay[index]];iDoW=new Date(instance.date).getDay();if(timeGrid.periods){iEndTime=instance.endTime.replace(":","");iStartTime=instance.startTime.replace(":","");relevantBlocks=at(iEndTime,iStartTime);showOwnTime=relevantBlocks.length>1}else{iDoW=iDoW-1;relevantBlocks=[0];showOwnTime=true}item=S(instance,showOwnTime);for(blockIndex in relevantBlocks){block=relevantBlocks[blockIndex];cell=aw[block].getElementsByTagName("td")[iDoW];cell.appendChild(item);cell.classList.add("instances")}}}function au(){const ay=a(),ax=aq.createTHead().insertRow(0);let headIndex;ay.setDate(ay.getDate()-ay.getDay());for(headIndex=0;headIndex<af;++headIndex){const aw=document.createElement("th");aw.innerHTML=(headIndex===0)?Joomla.JText._("ORGANIZER_TIME"):C[headIndex-1]+" ("+ay.getPresentationFormat(true)+")";if(headIndex===visibleDay){aw.classList.add("activeColumn")}ax.appendChild(aw);ay.setDate(ay.getDate()+1)}}function V(aB,ax){const ay=scheduleObjects.userSchedule.getTable().getTableElement(),az=ay.getElementsByTagName("tbody")[0].getElementsByTagName("tr"),aA=az[aB],aw=aA?aA.getElementsByTagName("td")[ax]:false;return aw&&aw.classList.contains("events")}function U(aw){let eventIndex,events;if(!aw||!scheduleObjects.userSchedule){return false}events=scheduleObjects.userSchedule.getTable().getEvents();for(eventIndex=0;eventIndex<events.length;++eventIndex){if(events[eventIndex].dataset.ccmID===aw.dataset.ccmID){return true}}return false}function ac(){const aB=document.createElement("tbody"),ax=aq.getElementsByTagName("tbody")[0],az=timeGrid.endDay,aw=timeGrid.periods?Object.keys(timeGrid.periods).length:1;let columnIndex,rowIndex;for(rowIndex=0;rowIndex<aw;++rowIndex){const aA=aB.insertRow(-1),ay=timeGrid.periods&&timeGrid.periods[rowIndex+1].type;if(ay){aA.classList.add(ay)}for(columnIndex=0;columnIndex<=az;++columnIndex){aA.insertCell(-1)}}aq.replaceChild(aB,ax)}function ar(){const aw=aq.getElementsByTagName("tr");let thIndex,ths,tdIndex,tds,row;for(row=0;row<aw.length;++row){ths=aw[row].getElementsByTagName("th");for(thIndex=1;thIndex<ths.length;++thIndex){if(thIndex===visibleDay){ths[thIndex].classList.add("activeColumn")}else{ths[thIndex].classList.remove("activeColumn")}}tds=aw[row].getElementsByTagName("td");for(tdIndex=1;tdIndex<tds.length;++tdIndex){if(tdIndex===visibleDay){tds[tdIndex].classList.add("activeColumn")}else{tds[tdIndex].classList.remove("activeColumn")}}}}function X(){const ax=aq.getElementsByTagName("thead")[0].getElementsByTagName("th"),ay=a(),aw=ay.getDay();let currentDay=parseInt(timeGrid.startDay),thElement;if(aw===0){ay.setDate(ay.getDate()+1)}else{ay.setDate(ay.getDate()-aw+1)}ax[0].style.display=timeGrid.hasOwnProperty("periods")?"":"none";for(thElement=1;thElement<ax.length;++thElement){if(thElement===currentDay&&currentDay<=timeGrid.endDay){ax[thElement].innerHTML=C[currentDay-1]+" ("+ay.getPresentationFormat(true)+")";ay.setDate(ay.getDate()+1);++currentDay}else{ax[thElement].innerHTML=""}}}function Y(){const ax=aq.getElementsByTagName("tbody")[0].getElementsByTagName("tr");let endTime,period=1,row,startTime;if(!timeGrid.periods){return}for(row=0;row<ax.length;++row){const ay=endTime?timeGrid.periods[period].startTime-timeGrid.periods[period-1].endTime:0,aw=ax[row].getElementsByTagName("td")[0];if(ay>=100){ax[row-1].classList.add("long-break-after")}startTime=timeGrid.periods[period].startTime.replace(/(\d{2})(\d{2})/,"$1:$2");endTime=timeGrid.periods[period].endTime.replace(/(\d{2})(\d{2})/,"$1:$2");aw.innerHTML=startTime+"<br> - <br>"+endTime;++period}}this.getEvents=function(){return instanceElements};this.getGridID=function(){return timeGridID};this.getTableElement=function(){return aq};this.remove=function(){f.removeChild(document.getElementById(ap.getId()+"-input"));f.removeChild(document.getElementById(ap.getId()+"-schedule"))};this.update=function(aw){instances=aw||instances;visibleDay=a().getDay();if(useDefaultGrid){timeGrid=W()}ac();X();Y();if(!(instances.pastDate||instances.futureDate)){aj(instances)}if(u.isMobile){ar()}};this.updateGrid=function(){useDefaultGrid=false;timeGrid=M();timeGridID=y("grid");this.update()};(function(){ao();au();Y()}())}function J(){const ag=document.getElementsByClassName("instance-menu")[0],ah=document.getElementById("delete-mode-instance"),aa=ag.getElementsByClassName("delete")[0],T=document.getElementById("delete-mode-period"),ac=document.getElementById("delete-mode-term"),ae=ag.getElementsByClassName("description")[0],af=ag.getElementsByClassName("module")[0],X=ag.getElementsByClassName("persons")[0],ad=ag.getElementsByClassName("groups")[0],Y=ag.getElementsByClassName("rooms")[0],V=document.getElementById("save-mode-instance"),S=ag.getElementsByClassName("save")[0],W=document.getElementById("save-mode-period"),U=document.getElementById("save-mode-term"),ab=ag.getElementsByClassName("subject")[0];let currentInstanceID="0";function Z(){D(X);D(Y);D(ad)}function R(aj){let groupID,roomID,personID;Z();ab.innerHTML=aj.name;if(aj.subjectNo===""){af.style.display="none"}else{af.style.display="inline-block";af.innerHTML=aj.subjectNo}ae.innerHTML=ag.parentNode.getElementsByClassName("comment-container")[0]?ag.parentNode.getElementsByClassName("comment-container")[0].innerText:"";for(personID in aj.persons){if(aj.persons.hasOwnProperty(personID)&&aj.personDeltas[personID]!=="removed"){const ai=document.createElement("span");ai.innerHTML=aj.persons[personID];X.appendChild(ai)}}for(roomID in aj.rooms){if(aj.rooms.hasOwnProperty(roomID)&&aj.roomDeltas[roomID]!=="removed"){const al=document.createElement("span");al.innerHTML=aj.rooms[roomID];Y.appendChild(al)}}for(groupID in aj.groups){if(aj.groups.hasOwnProperty(groupID)){const ak=document.createElement("span");ak.innerHTML=aj.groups[groupID].code;ad.appendChild(ak)}}}(function(){U.addEventListener("click",function(){x(currentInstanceID,u.SEMESTER_MODE,true);S.parentNode.style.display="none"});W.addEventListener("click",function(){x(currentInstanceID,u.BLOCK_MODE,true);S.parentNode.style.display="none"});V.addEventListener("click",function(){x(currentInstanceID,u.INSTANCE_MODE,true);S.parentNode.style.display="none"});ac.addEventListener("click",function(){x(currentInstanceID,u.SEMESTER_MODE,false);aa.parentNode.style.display="none"});T.addEventListener("click",function(){x(currentInstanceID,u.BLOCK_MODE,false);aa.parentNode.style.display="none"});ah.addEventListener("click",function(){x(currentInstanceID,u.INSTANCE_MODE,false);aa.parentNode.style.display="none"})}());this.getMenu=function(aj,ai,ak){currentInstanceID=aj.dataset.instanceID;if(ak=="save"){S.style.display="block";aa.style.display="none"}else{S.style.display="none";aa.style.display="block"}ag.style.display="block";aj.appendChild(ag);R(ai)}}function A(){this.schedules=[];this.userSchedule=null;this.addSchedule=function(S){let sessionSchedules=JSON.parse(window.sessionStorage.getItem("schedules"));const R={title:S.getTitle(),resource:S.getResource(),IDs:S.getResourceIDs()};if(S.getId()!=="user"){if(!sessionSchedules){sessionSchedules={}}sessionSchedules[S.getId()]=R;window.sessionStorage.setItem("schedules",JSON.stringify(sessionSchedules))}else{this.userSchedule=S}this.schedules.push(S)};this.removeSchedule=function(S){const R=JSON.parse(window.sessionStorage.getItem("schedules"));delete R[S.getId()];window.sessionStorage.setItem("schedules",JSON.stringify(R));if(S.getTable()){S.getTable().remove();this.schedules.splice(this.schedules.indexOf(S),1)}};this.getScheduleById=function(R){let scheduleIndex;for(scheduleIndex=0;scheduleIndex<this.schedules.length;++scheduleIndex){if(this.schedules[scheduleIndex].getId()===R){return this.schedules[scheduleIndex]}}return false};this.updateUserSchedule=function(){this.userSchedule.requestUpdate(true)};this.getActiveSchedule=function(){return this.getScheduleById(c())}}function r(){const X={},ah={name:"",values:[]},ab={category:document.getElementById("category"),group:document.getElementById("group"),organization:document.getElementById("organization"),person:document.getElementById("person"),room:document.getElementById("room"),roomtype:document.getElementById("roomtype"),type:document.getElementById("type")},U={category:Joomla.JText._("ORGANIZER_SELECT_CATEGORY"),group:Joomla.JText._("ORGANIZER_SELECT_GROUP"),person:Joomla.JText._("ORGANIZER_SELECT_PERSON"),room:Joomla.JText._("ORGANIZER_SELECT_ROOM"),roomtype:Joomla.JText._("ORGANIZER_SELECT_ROOMTYPE")},Y={category:document.getElementById("category-input"),group:document.getElementById("group-input"),organization:document.getElementById("organization-input"),person:document.getElementById("person-input"),room:document.getElementById("room-input"),roomtype:document.getElementById("roomtype-input"),type:document.getElementById("type-input")},T=JSON.parse(window.sessionStorage.getItem("scheduleForm"))||{},S=JSON.parse(window.sessionStorage.getItem("organization"))||{};function V(al,ak){const aj=document.querySelector("[data-next="+al.id+"]");let resource,url=N();resource=al.dataset.input==="static"?jQuery(al).val():al.id;url+="&view="+resource.replace(/([A-Z])/g,"_$&").toLowerCase()+"_options";if(aj){url+="&"+aj.id+"IDs="+(ak?ak:y(aj.id))}return url}function ai(ak){D(ak);if(U[ak.id]){const aj=document.createElement("option");aj.setAttribute("value","");aj.setAttribute("disabled","disabled");aj.setAttribute("selected","selected");aj.innerHTML=U[ak.id];ak.appendChild(aj)}}function ad(aj){if(u.isMobile){ab[aj.id].addEventListener("change",ae)}else{jQuery("#"+aj.id).chosen().change(function(){ae(aj.id)});Y[aj.id].querySelector(".chzn-results").addEventListener("click",function(){ae(aj.id)})}}function aa(aj){const ak=ab[aj].dataset.input==="static"?y(aj):"";let id;for(id in ab){if(ab.hasOwnProperty(id)){const al=ab[id];if(X[id.toLowerCase()]&&(id===aj||al.dataset.input==="static"||al.dataset.next===aj||id===ak)){jQuery(Y[id]).show()}else{jQuery(Y[id]).hide()}}}}function R(ak){if(ak.dataset.next!=="event"){const aj={};aj.name=ak.id;aj.value=y(ak.id);if(ak.id==="organization"){S[u.menuID]=aj;window.sessionStorage.setItem("organization",JSON.stringify(S))}else{T[u.menuID]=aj;window.sessionStorage.setItem("scheduleForm",JSON.stringify(T))}}}function W(){const aj=S[u.menuID],ak=T[u.menuID];if(aj){jQuery("#organization").val(aj.value).chosen("destroy").chosen()}if(ak){if(ak.name===ah.name){ag(ak.name,ak.value,ah.values)}else{if(ab[ak.name].dataset.input==="static"){jQuery(ab[ak.name]).val(ak.value).chosen("destroy").chosen();if(ab[ak.value]){ag(ak.value)}}else{ag(ak.name,ak.value)}}return true}return false}function ag(aj,ak,an){const al=new XMLHttpRequest(),am=ab[aj];al.open("GET",V(am,ak),true);al.onreadystatechange=function(){let option,optionCount,response,key;if(al.readyState===4&&al.status===200){response=JSON.parse(al.responseText);optionCount=an?an.length:Object.keys(response).length;ai(am);for(key in response){if(response.hasOwnProperty(key)&&(!an||an.includes(response[key]))){option=document.createElement("option");option.value=response[key].value;option.innerHTML=response[key].text;option.selected=(optionCount===1||option.value===ak);am.appendChild(option)}}if(optionCount===1||ak){if(am.dataset.next==="event"){l(am.id)}else{ag(am.dataset.next)}}jQuery(am).chosen("destroy").chosen();ad(am);aa(am.id)}};al.send()}function ae(ak){const aj=ab[ak]||ab[ak.target.id];if(aj.selectedIndex!==0){if(aj.dataset.next==="event"){l(aj.id);return}if(aj.dataset.input==="static"){ag(y(aj.id))}else{ag(aj.dataset.next)}R(aj)}}function ac(){let firstField,name;if(ah.name==="subject"||ah.name==="event"){firstField={id:ah.name,dataset:{next:"event"}}}else{firstField=ab[ah.name]||ab.type}name=firstField.id;if(ah.name){if(firstField.dataset.next==="event"){ah.values.forEach(function(al){const ak=new XMLHttpRequest(),aj=N()+"&view="+name+"s&task=getName&id="+al;ak.open("GET",aj,true);ak.onreadystatechange=function(){let title;if(ak.readyState===4&&ak.status===200){title=ak.responseText.replace(/"+/g,"");l(name,al,title)}};ak.send()});z("tab-selected-schedule")}else{ag(name,"",ah.values);z()}}else{ag(y(name));z()}}function af(){const aj={next:"",event:""};let name;for(name in ab){if(ab.hasOwnProperty(name)){const ak=ab[name],al=jQuery(Y[name]);if(al.css("display")!=="none"&&ak.dataset.input!=="static"){if(ak.dataset.next==="event"){aj.event=ak.id}else{aj.next=ak.id}}}}ag(aj.next||aj.event)}function Z(){let valueIndex,variable;for(variable in u){if(!u.hasOwnProperty(variable)){continue}const ak=/^(\w+)*IDs$/.exec(variable);let fieldID,showMatch=/^show(\w+)s$/i.exec(variable);if(ak){const aj=u[variable];ah.name=ak[1].toLowerCase();if(jQuery.isArray(aj)){for(valueIndex=0;valueIndex<aj.length;++valueIndex){ah.values.push(""+aj[valueIndex])}}else{ah.values.push(""+aj)}}if(showMatch){fieldID=showMatch[1].toLowerCase();fieldID=fieldID==="categorie"?"category":fieldID;X[fieldID]=u[variable]}}X.type=!ah.name}(function(){Z();if(!W()){ac()}jQuery("#type").chosen().change(function(){ag(y(this.id));R(this)});jQuery("#organization").chosen().change(function(){af();R(this)})})()}function N(){return u.ajaxBase+u.organizationID||y("organization")||0}function I(){const R=JSON.parse(window.sessionStorage.getItem("schedules"));if(R&&Object.keys(R).length>0){let id;for(id in R){if(R.hasOwnProperty(id)&&!scheduleObjects.getScheduleById(id)){new P(R[id].resource,R[id].IDs,R[id].title)}}if(scheduleObjects.schedules.length>0){s()}e(jQuery("#selected-schedules").find(".selected-schedule").last().attr("id"))}}function n(R){jQuery("#grid").val(R).chosen("destroy").chosen()}function l(S,U,T){const R=U||y(S,"-");let schedule=scheduleObjects.getScheduleById(S+R);if(schedule){schedule.requestUpdate()}else{schedule=new P(S,R,T)}s();e(schedule.getId())}function o(T){const R=T.pastDate?new Date(T.pastDate):null,S=T.futureDate?new Date(T.futureDate):null;Q.style.display="block";if(R){O.innerHTML=O.innerHTML.replace(k,R.getPresentationFormat());O.dataset.date=T.pastDate;jQuery(O).show()}else{jQuery(O).hide()}if(S){t.innerHTML=t.innerHTML.replace(k,S.getPresentationFormat());t.dataset.date=T.futureDate;jQuery(t).show()}else{jQuery(t).hide()}}function x(R,T,S){const U=(typeof S==="undefined")?true:S;let actionURL=N();actionURL+="&view=schedules&mode="+(T||"1")+"&instanceID="+R+"&task=";actionURL+=U?"saveUserLesson":"deleteUserLesson";v.open("GET",actionURL,true);v.onreadystatechange=function(){if(v.readyState===4&&v.status===200){const V=JSON.parse(v.responseText);scheduleObjects.schedules.forEach(function(Y){const X=Y.getTable().getEvents();let fifo=false,eventIndex,manual=false;for(eventIndex=0;eventIndex<X.length;++eventIndex){const W=X[eventIndex];if(V.includes(W.dataset.ccmID)){if(U){W.classList.add("added");if(W.dataset.regType===0){fifo=true}else{if(W.dataset.regType===1){manual=true}}}else{W.classList.remove("added");if(Y===scheduleObjects.userSchedule){jQuery(W).hide()}}}}if(fifo){w.style.display="block"}else{if(manual){H.style.display="block"}}});scheduleObjects.updateUserSchedule()}};v.send()}function B(W){const V=document.createElement("div"),U=document.createElement("button"),R=document.createElement("button");V.id=W.getId();V.className="selected-schedule";jQuery("#selected-schedules").append(V);U.className="title";U.innerHTML=W.getTitle();U.addEventListener("click",function(){e(W.getId())});V.appendChild(U);R.className="show-schedule";R.innerHTML='<span class="icon-eye-close"></span>';R.addEventListener("click",function(){e(W.getId())});V.appendChild(R);if(!u.isMobile){const S=document.createElement("button");S.className="pop-up-schedule";S.innerHTML='<span class="icon-move"></span>';S.addEventListener("click",function(){W.popUp(true)});V.appendChild(S)}if(W.getId()!=="user"){const T=document.createElement("button");T.className="remove-schedule";T.innerHTML='<span class="icon-remove"></span>';T.addEventListener("click",function(){G(V,W)});V.appendChild(T)}e(W.getId())}function e(S){const R=jQuery(".schedule-input"),T=scheduleObjects.getScheduleById(S);let schedulesIndex;for(schedulesIndex=0;schedulesIndex<R.length;++schedulesIndex){if(R[schedulesIndex].id===S+"-input"){R[schedulesIndex].checked="checked";jQuery(".selected-schedule").removeClass("shown");jQuery("#"+S).addClass("shown");if(T){n(scheduleObjects.getScheduleById(S).getTable().getGridID())}}}z()}function c(){const R=document.getElementById("selected-schedules").getElementsByClassName("shown")[0];return R?R.id:false}function G(R,S){R.parentNode.removeChild(R);scheduleObjects.removeSchedule(S);if(scheduleObjects.schedules.length===0){e("default");g()}else{e(jQuery("#selected-schedules").find(".selected-schedule").last().attr("id"))}}function D(T){const S=T.children,R=S.length-1;let index;for(index=R;index>=0;--index){T.removeChild(S[index])}}function y(S,V){const U=document.getElementById(S),T=U?U.options:undefined,R=[];if(U&&U.selectedIndex>-1){let index;for(index=0;index<T.length;++index){if(T[index].selected){R.push(T[index].value)}}return R.join(V||",")}return false}function b(V,S){const R=a(),U=S||"week",T=U==="week"?7:1;if(V){if(S==="month"){R.setMonth(R.getMonth()+T)}else{R.setDate(R.getDate()+T)}if(R.getDay()===0){R.setDate(R.getDate()+1)}}else{if(S==="month"){R.setMonth(R.getMonth()-T)}else{R.setDate(R.getDate()-T)}if(R.getDay()===0){R.setDate(R.getDate()-1)}}d.dateField.value=R.getPresentationFormat();window.sessionStorage.setItem("scheduleDate",R.toJSON())}function h(){const S=a(),R=S.getDate(),T=S.getMonth()+1;return S.getFullYear()+"-"+(T<10?"0"+T:T)+"-"+(R<10?"0"+R:R)}function a(){const S=d.dateField.value.match(k),R=u.dateFormat.charAt(0);if(S){if(R==="y"||R==="Y"){return new Date(parseInt(S[1],10),parseInt(S[2]-1,10),parseInt(S[3],10),12,0,0)}else{return new Date(parseInt(S[3],10),parseInt(S[2]-1,10),parseInt(S[1],10),12,0,0)}}return new Date()}function M(){return JSON.parse(u.grids[y("grid")].grid)}function F(R){if(R.parent("li").hasClass("active")){R.parent("li").toggleClass("inactive","");jQuery("#"+R.attr("data-id")).toggleClass("inactive","")}else{jQuery(".tabs-tab").removeClass("inactive");jQuery(".tab-panel").removeClass("inactive")}}function s(){const R=jQuery("#tab-selected-schedules");if(!R.parent("li").hasClass("disabled-tab")){R.parent("li").addClass("active");jQuery("#selected-schedules").addClass("active")}jQuery("#tab-schedule-form").parent("li").removeClass("active");jQuery("#schedule-form").removeClass("active")}function g(){const R=jQuery("#tab-schedule-form");if(!R.parent("li").hasClass("disabled-tab")){R.parent("li").addClass("active");jQuery("#schedule-form").addClass("active")}jQuery("#tab-selected-schedules").parent("li").removeClass("active");jQuery("#selected-schedules").removeClass("active")}function K(){const R=window.matchMedia("(max-width: 677px)");if(u.isMobile){jQuery(".date-input").insertAfter(".menu-bar")}R.addListener(function(){if(R.matches){jQuery(".date-input").insertAfter(".menu-bar")}else{jQuery(".date-input").insertAfter(jQuery(".tabs-tab").eq(-2))}})}function z(R){const U=jQuery(".schedule-input"),T=[jQuery("#tab-selected-schedules"),jQuery("#tab-time-selection"),jQuery("#tab-exports")];let i;if(R){const S=jQuery(".tabs-toggle");for(i=0;i<S.length;++i){if(R!==S[i].id){S[i].dataset.toggle="";S[i].parentElement.classList.add("disabled-tab")}}}else{if(U.length===1&&U.is("#default-input")){for(i=0;i<T.length;++i){T[i].attr("data-toggle","");T[i].parent("li").addClass("disabled-tab")}}else{for(i=0;i<T.length;++i){T[i].attr("data-toggle","tab");T[i].parent("li").removeClass("disabled-tab")}}}}function q(R){R.preventDefault();R.dataTransfer.dropEffect="move"}function j(S){const T=JSON.parse(S.dataTransfer.getData("text")),R=document.getElementById(T.id),V=window.getComputedStyle(R).getPropertyValue("left"),U=window.getComputedStyle(R).getPropertyValue("top");let matchLeft,matchTop,oldLeft,oldTop;S.preventDefault();matchLeft=V.match(/^(-?\d+)\w*$/);oldLeft=matchLeft?matchLeft[1]:0;matchTop=U.match(/^(-?\d+)\w*$/);oldTop=matchTop?matchTop[1]:0;R.style.left=parseInt(oldLeft,10)+parseInt(S.pageX-T.x,10)+"px";R.style.top=parseInt(oldTop,10)+parseInt(S.pageY-T.y,10)+"px";R.style.zIndex=E(".pop-up.schedule-table")}function E(R){const S=document.querySelectorAll(R);let index,maxZIndex=1;for(index=0;index<S.length;++index){const T=parseInt(window.getComputedStyle(S[index]).getPropertyValue("z-index"));maxZIndex=Math.max(T,maxZIndex)}return ++maxZIndex}this.dateField=document.getElementById("date");this.updateSchedule=function(S){const R=scheduleObjects.getScheduleById(S);if(R){R.requestUpdate()}else{scheduleObjects.schedules.forEach(function(T){T.requestUpdate()})}};this.changeGrid=function(){scheduleObjects.getActiveSchedule().getTable().updateGrid()};this.nextDateEventHandler=function(S){const R=new Date(S.target.dataset.date);this.dateField.value=R.getPresentationFormat();window.sessionStorage.setItem("scheduleDate",R.toJSON());Q.style.display="none";this.updateSchedule()};this.handleExport=function(T){const S=jQuery("#export-selection"),V=c(),R=T.split(".");let url=u.exportBase;url+="&format="+R[0];if(R[0]==="pdf"){url+="&gridID="+u.grids[y("grid")].id}if(R[1]!==undefined){url+="&documentFormat="+R[1]}if(typeof u.username!=="undefined"&&typeof u.auth!=="undefined"){url+="&username="+u.username+"&auth="+u.auth}if(V==="user"){url+="&myschedule=1"}else{const U=V.match(/[0-9]+/);if(U===null){return}if(V.search(/group/)===0){url+="&groupIDs="+U}else{if(V.search(/room/)===0){url+="&roomIDs="+U}else{if(V.search(/person/)===0){url+="&personIDs="+U}else{return}}}}if(R[0]==="ics"){window.prompt(Joomla.JText._("ORGANIZER_GENERATE_LINK"),url);S.val("placeholder");S.trigger("chosen:updated");return}url+="&date="+h();window.open(url);S.val("placeholder");S.trigger("chosen:updated")};this.getCalendar=function(){return calendar};Date.prototype.getPresentationFormat=function(S){const R=this.getDate(),U=R<10?"0"+R:R,W=this.getMonth()+1,V=W<10?"0"+W:W,X=this.getFullYear(),T=X.toString().substr(2,2);let date=u.dateFormat;date=date.replace(/j/,R.toString());date=date.replace(/d/,U);date=date.replace(/n/,W.toString());date=date.replace(/m/,V);if(typeof S==="undefined"?false:S){date=date.replace(/[yY]/,T.toString())}else{date=date.replace(/Y/,X.toString());date=date.replace(/y/,T.toString())}return date};if(!Array.prototype.includes){Array.prototype.includes=function(R){return this.indexOf(R)>=0}}(function(){const R=window.sessionStorage.getItem("scheduleDate"),S=R?new Date(R):new Date();let startX,startY;d.dateField.value=S.getPresentationFormat();calendar=new p();instanceMenu=new J();scheduleObjects=new A();form=new r();if(u.userID&&!scheduleObjects.getScheduleById("user")){new P("user");s()}K();I();f.addEventListener("touchstart",function(T){const U=T.changedTouches[0];startX=parseInt(U.pageX,10);startY=parseInt(U.pageY,10)},{passive:true});f.addEventListener("touchend",function(W){const X=W.changedTouches[0],U=parseInt(X.pageX,10)-startX,T=parseInt(X.pageY,10)-startY,V=50;if(Math.abs(U)>Math.abs(T)){if(U<-(V)){W.stopPropagation();b(true,u.isMobile?"day":"week");d.updateSchedule()}else{if(U>V){W.stopPropagation();b(false,u.isMobile?"day":"week");d.updateSchedule()}}}});jQuery("#schedules").chosen().change(function(){const T=document.getElementById(jQuery("#schedules").val());T.checked="checked"});jQuery(".tabs-toggle").on("click",function(T){F(jQuery(this));T.preventDefault()});document.getElementById("main").addEventListener("drop",j);document.getElementById("main").addEventListener("dragover",q)})();jQuery(document).mouseup(function(U){const S=jQuery("#calendar"),T=jQuery(".message.pop-up"),R=jQuery(".instance-menu");if(!R.is(U.target)&&R.has(U.target).length===0){R.hide(0)}if(!T.is(U.target)&&T.has(U.target).length===0){T.hide(0)}if(jQuery(".controls").css("display")!=="none"){if(calendar.isVisible()&&!S.is(U.target)&&S.has(U.target).length===0){calendar.hideCalendar()}}})};